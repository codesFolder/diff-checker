<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Difference Checker</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0; 
            padding: 20px;
            background-color: #f6f8fa;
            color: #24292e;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { text-align: center; }
        .text-inputs { display: flex; gap: 20px; }
        textarea {
            width: 100%;
            height: 300px;
            font-family: monospace;
            font-size: 14px;
            padding: 10px;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            box-sizing: border-box; /* Ensures padding is included in width/height */
        }

        /* --- NEW: Editor & Paste Button Styling --- */
        .editor-container {
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding: 0 5px;
            font-size: 0.9em;
            color: #586069;
        }
        .paste-btn {
            font-size: 0.8rem;
            padding: 3px 10px;
            font-weight: 500;
        }

        .main-controls { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 20px; 
            margin: 20px 0;
        }
        .options { display: flex; gap: 15px; font-size: 0.9rem; }
        .options label { cursor: pointer; user-select: none; }
        
        button {
            font-size: 1.1rem;
            padding: 8px 20px;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            border: 1px solid rgba(27, 31, 35, 0.15);
        }
        #compareButton { background-color: #2ea44f; color: white; }
        #compareButton:hover { background-color: #2c974b; }
        .secondary-btn { background-color: #f6f8fa; color: #24292e; }
        .secondary-btn:hover { background-color: #f3f4f6; }
        
        #summary-output {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #d1d5da;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }
        
        #stats-output { display: flex; justify-content: space-around; margin-top: 15px; }
        .stats-box { text-align: center; padding: 0 20px; }
        .stats-box h3 { margin-top: 0; color: #586069; font-size: 1em; }
        .stats-box p { margin: 5px 0; font-size: 0.9em; }

        #diff-output { margin-top: 20px; border: 1px solid #d1d5da; border-radius: 6px; overflow-x: auto; }
        table.diff { border-collapse: collapse; width: 100%; font-family: monospace; font-size: 13px; white-space: pre; }
        .diff th { text-align: right; padding: 4px; background-color: #f6f8fa; color: #586069; user-select: none; }
        .diff td { padding: 4px; vertical-align: top; }
        .diff_header { background-color: #e6ebf1; padding: 8px; font-weight: bold; text-align: center; }
        .diff_add { background-color: #e6ffed; }
        .diff_chg { background-color: #fffbdd; }
        .diff_sub { background-color: #ffeef0; }
    </style>
</head>
<body>
    <div class="container">
        <!-- TITLE UPDATED -->
        <h1>Text Difference Checker</h1>

        <!-- HTML STRUCTURE UPDATED FOR PASTE BUTTONS -->
        <div class="text-inputs">
            <div class="editor-container">
                <div class="editor-header">
                    <span>Original Text</span>
                    <button id="paste1" class="secondary-btn paste-btn">Paste</button>
                </div>
                <textarea id="text1" placeholder="Paste the original text here..."></textarea>
            </div>
            <div class="editor-container">
                <div class="editor-header">
                    <span>New Text</span>
                    <button id="paste2" class="secondary-btn paste-btn">Paste</button>
                </div>
                <textarea id="text2" placeholder="Paste the new text here..."></textarea>
            </div>
        </div>

        <div id="stats-output"></div>

        <div class="main-controls">
            <button id="swapButton" class="secondary-btn">Swap</button>
            <button id="compareButton">Compare</button>
            <div class="options">
                <label><input type="checkbox" id="ignoreWhitespace"> Ignore Whitespace</label>
                <label><input type="checkbox" id="caseInsensitive"> Case-Insensitive</label>
            </div>
            <button id="clearButton" class="secondary-btn">Clear All</button>
        </div>

        <div id="summary-output" style="display: none;">
            <span id="summaryMessage"></span>
            <button id="copySummaryButton" class="secondary-btn">Copy</button>
        </div>
        
        <div id="diff-output"></div>
    </div>

    <script>
        // Get all element references
        const text1El = document.getElementById('text1');
        const text2El = document.getElementById('text2');
        const compareButton = document.getElementById('compareButton');
        const clearButton = document.getElementById('clearButton');
        const swapButton = document.getElementById('swapButton');
        const ignoreWhitespaceEl = document.getElementById('ignoreWhitespace');
        const caseInsensitiveEl = document.getElementById('caseInsensitive');
        
        const statsDiv = document.getElementById('stats-output');
        const summaryDiv = document.getElementById('summary-output');
        const summaryMessageEl = document.getElementById('summaryMessage');
        const copySummaryButton = document.getElementById('copySummaryButton');
        const outputDiv = document.getElementById('diff-output');
        
        // --- NEW: References for Paste Buttons ---
        const paste1Btn = document.getElementById('paste1');
        const paste2Btn = document.getElementById('paste2');

        // --- NEW: Event Listeners for Paste Buttons ---
        paste1Btn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                text1El.value = text;
            } catch (err) {
                console.error('Failed to read clipboard: ', err);
                alert('Could not paste from clipboard. Please ensure you have granted permission.');
            }
        });

        paste2Btn.addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                text2El.value = text;
            } catch (err) {
                console.error('Failed to read clipboard: ', err);
                alert('Could not paste from clipboard. Please ensure you have granted permission.');
            }
        });
        
        // --- Event Listeners for other Buttons ---
        clearButton.addEventListener('click', () => {
            text1El.value = '';
            text2El.value = '';
            statsDiv.innerHTML = '';
            summaryDiv.style.display = 'none';
            outputDiv.innerHTML = '';
        });

        swapButton.addEventListener('click', () => {
            const temp = text1El.value;
            text1El.value = text2El.value;
            text2El.value = temp;
        });

        copySummaryButton.addEventListener('click', () => {
            navigator.clipboard.writeText(summaryMessageEl.innerText).then(() => {
                const originalText = copySummaryButton.innerText;
                copySummaryButton.innerText = 'Copied!';
                setTimeout(() => {
                    copySummaryButton.innerText = originalText;
                }, 1500);
            });
        });

        compareButton.addEventListener('click', async () => {
            // ... (The rest of the compare logic remains exactly the same) ...
            outputDiv.innerHTML = '<p style="text-align: center; padding: 20px;">Comparing...</p>';
            statsDiv.innerHTML = '';
            summaryDiv.style.display = 'none';

            const payload = {
                text1: text1El.value,
                text2: text2El.value,
                ignoreWhitespace: ignoreWhitespaceEl.checked,
                caseInsensitive: caseInsensitiveEl.checked,
            };

            try {
                const response = await fetch('/api/main', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                outputDiv.innerHTML = data.diff_html;

                const stats = data.stats;
                statsDiv.innerHTML = `
                    <div class="stats-box">
                        <h3>Original Text</h3>
                        <p><strong>Chars:</strong> ${stats.text1.chars} | <strong>Words:</strong> ${stats.text1.words} | <strong>Lines:</strong> ${stats.text1.lines}</p>
                    </div>
                    <div class="stats-box">
                        <h3>New Text</h3>
                        <p><strong>Chars:</strong> ${stats.text2.chars} | <strong>Words:</strong> ${stats.text2.words} | <strong>Lines:</strong> ${stats.text2.lines}</p>
                    </div>
                `;

                const summary = data.summary;
                let message = '';
                if (summary.added === 0 && summary.deleted === 0) {
                    message = '✅ No differences found.';
                } else {
                    const changes = [];
                    if (summary.added > 0) changes.push(`<strong>${summary.added}</strong> line(s) added`);
                    if (summary.deleted > 0) changes.push(`<strong>${summary.deleted}</strong> line(s) removed`);
                    message = `⚠️ Differences found: ${changes.join(', ')}.`;
                }
                summaryMessageEl.innerHTML = message;
                summaryDiv.style.display = 'flex';

            } catch (error) {
                console.error('Error comparing texts:', error);
                outputDiv.innerHTML = '<p style="color: red; text-align: center; padding: 20px;">An error occurred.</p>';
            }
        });
    </script>
</body>
</html>
